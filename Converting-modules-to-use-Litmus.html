<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.6.1 -->
<title>Puppet Litmus Test Tool | .</title>
<meta name="generator" content="Jekyll v4.1.0" />
<meta property="og:title" content="Puppet Litmus Test Tool" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="The following example walks you through converting a module to use Litmus testing." />
<meta property="og:description" content="The following example walks you through converting a module to use Litmus testing." />
<link rel="canonical" href="https://puppetlabs.github.io/litmus/Converting-modules-to-use-Litmus.html" />
<meta property="og:url" content="https://puppetlabs.github.io/litmus/Converting-modules-to-use-Litmus.html" />
<meta property="og:site_name" content="Puppet Litmus Test Tool" />
<script type="application/ld+json">
{"description":"The following example walks you through converting a module to use Litmus testing.","@type":"WebPage","url":"https://puppetlabs.github.io/litmus/Converting-modules-to-use-Litmus.html","headline":"Puppet Litmus Test Tool","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/litmus/assets/main.css"><link type="application/atom+xml" rel="alternate" href="https://puppetlabs.github.io/litmus/feed.xml" title="Puppet Litmus Test Tool" />
    <!-- Google Analytics -->
    <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-157301458-1', 'auto');
	ga('send', 'pageview', { 'page': location.pathname + location.search + location.hash});
	ga('set', 'anonymizeIp', true);
    </script>
    <!-- End Google Analytics -->
    </head>
<body><header class="site-header" role="banner">

  <div class="wrapper"><a class="site-title" rel="author" href="/litmus/">Puppet Litmus Test Tool</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"><a class="page-link" href="/litmus/about/">About</a></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post">

  <header class="post-header">
    <h1 class="post-title"></h1>
  </header>

  <div class="post-content">
    <p>The following example walks you through converting a module to use Litmus testing.</p>

<p>The process involves adding code to the following files:</p>

<ol>
  <li>The <code class="language-plaintext highlighter-rouge">Gemfile</code></li>
  <li>The <code class="language-plaintext highlighter-rouge">Rakefile</code></li>
  <li>The<code class="language-plaintext highlighter-rouge">.fixtures.yml</code> file</li>
  <li>The <code class="language-plaintext highlighter-rouge">spec_helper_acceptance.rb</code> file</li>
  <li>The <code class="language-plaintext highlighter-rouge">spec_helper_acceptance_local.rb</code> file</li>
</ol>

<h3 id="before-you-begin">Before you begin</h3>

<p><strong><em>Important:</em></strong> If your module is compatible with <a href="https://puppet.com/docs/pdk/1.x/pdk.html">Puppet Development Kit (PDK)</a>, meaning it was either created with PDK or has been converted to use PDK using the <code class="language-plaintext highlighter-rouge">pdk convert</code> command, you can convert your module to use Litmus using sync.yml. This means you can skip step 1 and 2 (add code to your <code class="language-plaintext highlighter-rouge">Gemfile</code> and <code class="language-plaintext highlighter-rouge">Rakefile</code>), and move straight to step 3 (Add code to the spec file). PDK manages the Gemfile and Rakefile, and these file changes go through sync.yml. To verify that your module is compatible with PDK, look in the modules <code class="language-plaintext highlighter-rouge">metadata.json</code> file and see whether there is an entry that states the PDK version. It will look something like <code class="language-plaintext highlighter-rouge">"pdk-version": "1.17.0"</code>.</p>

<p>You need to make the rest of the changes manually — step 3 onwards.</p>

<h3 id="1-add-code-to-your-gemfile-and-rakefile">1. Add code to your <code class="language-plaintext highlighter-rouge">Gemfile</code> and <code class="language-plaintext highlighter-rouge">Rakefile</code></h3>

<p><strong><em>Note</em></strong> If your module is compatible with PDK, skip this step and move to step 3.</p>

<p>Inside the root directory of your module, add the following code to <code class="language-plaintext highlighter-rouge">group :development</code> section of the <code class="language-plaintext highlighter-rouge">Gemfile</code>:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">gem</span> <span class="s1">'puppet_litmus'</span>
<span class="n">gem</span> <span class="s1">'serverspec'</span>

</code></pre></div></div>
<p>This code makes sure the <code class="language-plaintext highlighter-rouge">puppet_litmus</code> library is included in the module. You can now remove the system tests section, as Beaker is no longer needed.</p>

<h3 id="1-add-code-to-your-rakefile">1. Add code to your <code class="language-plaintext highlighter-rouge">Rakefile</code></h3>

<p><strong><em>Note</em></strong> If your module is compatible with PDK, skip this step and move to step 3.</p>

<p>Inside the root directory of your module, add the following code to the <strong>top</strong> of the <code class="language-plaintext highlighter-rouge">Rakefile</code>:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">require</span> <span class="s1">'puppet_litmus/rake_tasks'</span>
</code></pre></div></div>

<p>This code adds the Litmus rake tasks to the module.</p>

<h3 id="2-add-code-to-the-fixturesyml-file">2. Add code to the <code class="language-plaintext highlighter-rouge">.fixtures.yml</code> file</h3>

<p>Inside the root directory of your module, add the following code to the <code class="language-plaintext highlighter-rouge">.fixtures.yml</code>:</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nn">---</span>
<span class="na">fixtures</span><span class="pi">:</span>
  <span class="na">repositories</span><span class="pi">:</span>
    <span class="na">facts</span><span class="pi">:</span> <span class="s1">'</span><span class="s">https://github.com/puppetlabs/puppetlabs-facts.git'</span>
    <span class="na">puppet_agent</span><span class="pi">:</span> <span class="s1">'</span><span class="s">https://github.com/puppetlabs/puppetlabs-puppet_agent.git'</span>
    <span class="na">provision</span><span class="pi">:</span> <span class="s1">'</span><span class="s">https://github.com/puppetlabs/provision.git'</span>
</code></pre></div></div>

<h3 id="3-add-code-to-the-specspec_helper_acceptancerb-file">3. Add code to the spec/spec_helper_acceptance.rb file</h3>

<p>Inside the <code class="language-plaintext highlighter-rouge">spec</code> folder of the module, add the following code to the <code class="language-plaintext highlighter-rouge">spec_helper_acceptance.rb</code> file:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># frozen_string_literal: true</span>

<span class="nb">require</span> <span class="s1">'puppet_litmus'</span>
<span class="nb">require</span> <span class="s1">'spec_helper_acceptance_local'</span> <span class="k">if</span> <span class="no">File</span><span class="p">.</span><span class="nf">file?</span><span class="p">(</span><span class="no">File</span><span class="p">.</span><span class="nf">join</span><span class="p">(</span><span class="no">File</span><span class="p">.</span><span class="nf">dirname</span><span class="p">(</span><span class="kp">__FILE__</span><span class="p">),</span> <span class="s1">'spec_helper_acceptance_local.rb'</span><span class="p">))</span>

<span class="no">PuppetLitmus</span><span class="p">.</span><span class="nf">configure!</span>
</code></pre></div></div>

<p>If you can’t find this file, it means the module doesn’t have any acceptance tests and you will need to add them. For the purposes of this example, create the file and add the code above.</p>

<h3 id="4-update-the-specspec_helper_acceptance_localrb-file">4. Update the <code class="language-plaintext highlighter-rouge">spec/</code>spec_helper_acceptance_local.rb` file</h3>

<p>You might need to have an additional helper before you start running tests. If you need to use any of the Litmus methods in the following file, include Litmus in a singleton class:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">require</span> <span class="s1">'puppet_litmus'</span>
<span class="nb">require</span> <span class="s1">'singleton'</span>

<span class="k">class</span> <span class="nc">Helper</span>
  <span class="kp">include</span> <span class="no">Singleton</span>
  <span class="kp">include</span> <span class="no">PuppetLitmus</span>
<span class="k">end</span>

<span class="k">def</span> <span class="nf">some_helper_method</span>
  <span class="no">Helper</span><span class="p">.</span><span class="nf">instance</span><span class="p">.</span><span class="nf">bolt_run_script</span><span class="p">(</span><span class="s1">'path/to/file'</span><span class="p">)</span>
<span class="k">end</span>
</code></pre></div></div>

  </div>

</article>

      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/litmus/"></data>

  <div class="wrapper">

    <h2 class="footer-heading">Puppet Litmus Test Tool</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li class="p-name">Puppet Litmus Test Tool</li><li><a class="u-email" href="mailto:ia_content@puppet.com">ia_content@puppet.com</a></li></ul>
      </div>

      <div class="footer-col footer-col-2"><ul class="social-media-list"><li><a href="https://github.com/puppetlabs"><svg class="svg-icon"><use xlink:href="/litmus/assets/minima-social-icons.svg#github"></use></svg> <span class="username">puppetlabs</span></a></li></ul>
</div>

      <div class="footer-col footer-col-3">
        <p>.</p>
      </div>
    </div>

  </div>

</footer>
</body>

</html>
